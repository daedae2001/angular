<!DOCTYPE html>
<html>

<head>
   <link rel="stylesheet" media="screen,projection" type="text/css" href="./css/principal.css" />
  <script type="text/javascript" src="./js/datos.js"></script> 
  <script type="text/javascript" src="./js/funciones.js"></script>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>Control options</title>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    
    #map {
      height: 100%;
      width: 100%;
           }
    #map,#canvas {
      height: 100%;
      width: 100%;
           }
  </style>
</head>

<body onmousemove="showCoords(event)" onclick="dibuja()" >
 <div id="menu">
    <input type="text" id="hi" name="usuario" value=0>
 </div>
 <div id="Status_Timer">Timer detenido</div>
<canvas id="canvas"  >

   </canvas> 
 <div id="map"></div>
<p>Su navegador no soporta HTML5</p>
</canvas>

  
  <script>
    var posx = 0;
	 var posy = 0;
   var tim=0;
  var canvas;
   var ctx;
 
   function dibuja(){
if(tim==0){
Iniciar_Timer()
}
else{
Detener_Timer()
}

   }
   
    function Iniciar_Timer() {
     tim=1;
        Contador = 0;
        Handle_Mi_Timer = window.setInterval('Mi_Timer()', 5);  // en milisegundos, 1000=1 segundo
    }

    function Detener_Timer() {
      tim=0;
        if(Handle_Mi_Timer!=null) {
            window.clearInterval(Handle_Mi_Timer);
            Handle_Mi_Timer = null;
                 }
    }

    function Mi_Timer() {
        Contador++;
        canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d");
        ctx.fillStyle = "#000";
        ctx.fillRect (posx, posy, 10, 10);
    
    }
     
     

  function showCoords(event) {
    posx = event.clientX;
    posy = event.clientY;
    var coords = "X coords: " + posx + ", Y coords: " + posy;
    document.getElementById("Status_Timer").innerHTML = coords;
}




    var map
    var markers = [];
    var zoom;
    var xx;
    var yy;
    var la_center = -31.368244
    var lg_center = -64.232644
    

    function myMap() {
      var mapProp = {
        center: {
          lat: la_center,
          lng: lg_center
        },
        zoom: 13,
        styles:stylesArray
       // mapTypeControl: true,//scaleControl: true,
      };
       map = new google.maps.Map(document.getElementById("map"), mapProp);
      var styledMap = new google.maps.StyledMapType(stylesArray, {
        name: "Styled Map"
      });
      map.mapTypes.set('map_style', styledMap);
      map.setMapTypeId('map_style');
    
       map.addListener('zoom_changed', function() {
     
       //ms_hi1(Event);
        //setTimeout(function(){drop();}, 500);
      setMarkers(map, farmacias);
      
      });
       
     setMarkers(map, farmacias);
      
    }
 
    
    function setMarkers(map, farmacias) {
    clearMarkers();
      markers = [];

      for (var i = 0; i < farmacias.length; i++) {
setTimeout(function(){  }, 5500);
        var etiquetainfiwindows = farmacias[i][0]
        var lat1 = farmacias[i][2]
        var long1 = farmacias[i][3]
        var lat2 = farmacias[i][2]
        var long2 = farmacias[i][3]
        var tam_f = farmacias[i][6] /10* ( convierte_escala_zoom( map.getZoom()))
        var zom =  map.getZoom()
        var escala =  ( convierte_escala_zoom( map.getZoom()))
        var prestador = farmacias[i][0]
        var direccion = farmacias[i][1]
        var frecuencia = farmacias[i][4]
        var Facturado = farmacias[i][5]

        var a = document.getElementById("hi");
        a.value =" zoom "+convierte_escala_zoom( map.getZoom()) +"tam_f "+ tam_f  ;

        latlngset = new google.maps.LatLng(lat1, long1);

        var image = {
          url: './imagenes/CF4.gif',
          scaledSize: new google.maps.Size( tam_f , tam_f ),
          strokeOpacity: 0.9  }; //origin: new google.maps.Point(0, 0),//anchor: new google.maps.Point(17, 34),size: new google.maps.Size(71, 71), 

         marker = new google.maps.Marker({
         map: map,
          title: etiquetainfiwindows,
          position: latlngset,
          icon: image,
          optimized: false,
          draggable: false,
          alpha: 0.7,
          flat: true, 
          animation:google.maps.Animation.DROP,
         // animation:google.maps.Animation.BOUNCE,
                     
        }); //alpha=opacidad , flat=permite cambiar la orientacion del marcador
       
       var contentString = html_info_market_1(etiquetainfiwindows, escala, zom);

       var content = html_info_market_1(etiquetainfiwindows, escala, zom)

       var infowindow = new google.maps.InfoWindow()

        google.maps.event.addListener(marker, 'click', (function (marker, content, infowindow) {
          return function () {
            infowindow.setContent(content);
            infowindow.open(map, marker);   };   })(marker, content, infowindow)); 

 addMarkerWithTimeout(marker,400)


        
      }//cierre for
 //showMarkers()
    }



     function drop() {
        clearMarkers();
        for (var i = 0; i < neighborhoods.length; i++) {
          // Se agrega un marker con un tiempo diferente
          addMarkerWithTimeout(neighborhoods[i], i * 1000);
        }
      }
       
      // Agrega un marker con una animación después de un tiempo (timeout)
      function addMarkerWithTimeout(marker, timeout) {
        window.setTimeout(function() {
          markers.push(marker);
        }, timeout);
      }
       
      // Elimina los markers del mapa
      function clearMarkers() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        }
        markers = [];
      }

    
   
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAokBagH1RuklshFgw5THHzLHXFTt6Pk2Q&callback=myMap">
   
  </script>
    <input type="text" id="hi" name="usuario" value=0>
</body>

</html>